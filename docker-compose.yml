version: '3.8'

services:
  code-agent-api:
    build: .
    container_name: code-agent-api
    env_file:
      - .env
    ports:
      - "8000:8000"
    volumes:
      # Mount repos directory to persist cloned repositories
      - ./repos:/app/repos
    restart: unless-stopped
    environment:
      # Repository and Git Configuration
      - REPOS_DIR=/app/repos
      - GIT_PYTHON_REFRESH=quiet

      # GitHub Configuration (from .env file via env_file)
      # - GITHUB_TOKEN
      # - GITHUB_REPO
      # - GITHUB_WEBHOOK_SECRET

      # LLM Configuration (from .env file via env_file)
      # - OPENROUTER_API_KEY
      # - LLM_BASE_URL
      # - CODE_AGENT_MODEL

      # Override if needed (uncomment and set value)
      # - CODE_AGENT_MODEL=llama-3.3-70b-versatile
      # - LLM_BASE_URL=https://api.groq.com/openai/v1

  review-agent-api:
    build:
      context: .
      dockerfile: Dockerfile.review
    container_name: review-agent-api
    env_file:
      - .env
    ports:
      - "8001:8001"
    volumes:
      # Mount repos directory to persist cloned repositories
      - ./repos:/app/repos
    restart: unless-stopped
    environment:
      # Repository and Git Configuration
      - REPOS_DIR=/app/repos
      - GIT_PYTHON_REFRESH=quiet

      # Review Agent Configuration
      - REVIEW_AGENT_EXECUTE=true

      # GitHub Configuration (from .env file via env_file)
      # - GITHUB_TOKEN
      # - GITHUB_REPO
      # - GITHUB_WEBHOOK_SECRET

      # LLM Configuration (from .env file via env_file)
      # - OPENROUTER_API_KEY
      # - LLM_BASE_URL
      # - REVIEW_AGENT_MODEL

      # Override if needed (uncomment and set value)
      # - REVIEW_AGENT_MODEL=llama-3.3-70b-versatile
      # - LLM_BASE_URL=https://api.groq.com/openai/v1
